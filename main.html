<!DOCTYPE html>
<html>

<head>
    <title>GAsp_mainPage</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./css/main.css">
    <link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
        crossorigin="anonymous">
	<script type="text/javascript" src="./js/GAManager.js"></script>	
    <script type="text/javascript" src="./js/classes.js"></script>  
</head>

<body>
    <div id="error"></div>
	<div id="goBackStart"></div>
    <div id="header">
        <h4 id="title"> GAsp</h4>
        <h1> a web GA manipulator</h1>
    </div>

    <div id="signIn" class="sign ">
        <h4> Sign in </h4>
            <div id="errorForm"></div>
        <form id="form" method="post" action="">
            <p>
                <label> Mail </label> : <input type="text" name="username" id="mailIn"/>
            </p>
            <p>
                <label> Password </label> : <input type="password" name="password" id="passwordIn"/>
            </p>
        </form>

        <div class="validate">
                <i id="check" class="fas fa-check-square"> </i>
        </div>
    </div>
    
    <div id="chooseGA" class="chooseGA">
        <div class="chooseInfo">
            <div class="choose">
                <h4> Choose the geometric algebra </h4>
                <div class="validate">
                    <i class="fas fa-check-square"></i>
                </div>
            </div>

            <div class="infoGA">
                <h4> GA informations </h4>
                <p> lorem ipsum </p>
                <p> lorem ipsum </p>
                <p> lorem ipsum </p>
                <p> lorem ipsum </p>
                <p> lorem ipsum </p>
                <p> lorem ipsum </p>
            </div>
        </div>
        <div class="createGA">
            <div id="or">
                <h3> or </h3>
            </div>
            <div id="createGA" class="create">

                <h4> Create a geometric algebra</h4>
            </div>
        </div>
    </div>

   <div id="createAlgebra" class="createAlgebra">
        <h3>Create a geometric algebra</h3>
        <form id="formCreateGA">
            <p>
                <label> Name </label> : <input type="text" name="nameGA" />
            </p>
            <p>
                <label> Dimension </label> : <input type="text" name="dimensionGA" />
				<span class="GADefExamples">ex : p:3,q:0,r:1</span>
			</p>
            <p>
                <label> Basis </label> : <input type="text" name="basisGA" />
				<span class="GADefError">Enter <em></em>values</span>
				<span class="GADefExamples">(ex : '1', 'e12', 'e13', 'e23')</span>
            </p>
            <p>
                <label> Metric </label> : <input type="text" name="metricGA" />
				<span class="GADefError">Enter <em></em>values</span>
				<span class="GADefExamples">(ex : 1, 1, 1, 1, -1)</span>
            </p>
            <p>
                <label>(optional) Definition of new vectors from basis</label> : <textarea name="vectorsGA"></textarea>
				<span class="GADefExamples">ex : var e0 = 0.5*(1e12 + 1e23); var ei = 1e12 - 1e23</span>
            </p>
            <p>
                <label>(optional) Definition from a 3D Euclidean point (x,y,z)</label> : <input type="text" name="pointGA" />
				<span class="GADefExamples">ex : 1e123-x*1e012+y*1e013+(z||0)*1e023</span>
			</p>
        </form>
		<div class="validate">
			<a href="index.html">
				<i class="fas fa-check-square"></i>
			</a>
        </div>
    </div>
    
    <div id="icons">
        <a href ="index.html" >
        <div id="iconExample" class="circleBase type1 indexPage" target="_blank">
            <img  src="media/img/examples_icon.png" alt="new file" >
            <h3>Discover with examples</h3>
        </div>
    </a>

        <div id="iconCreate" class="circleBase">
            <img  src="media/img/new_file_icon.png" alt="new file">
            <h3>Create a new project</h3>
        </div>

        <div id="iconOpen" class="circleBase type1">
            <img  src="media/img/open_file_icon.png" alt="new file">
            <h3>Open a project</h3>
        </div>

    </div>

    <div id="save"></div>
    <div id="menuAccount"></div>
    <div id="pop_up_black"></div>

    <script>

		var els={};
		["#iconOpen", "#iconCreate", "#signIn", "#chooseGA","#validate","#projectList","#goBackStart","#formCreateGA","#check"].forEach(x=>els[x.replace(/[.#]/g,'')]=document.querySelector(x));
		changeActive = (element) => {
            element.classList.toggle("active");
        }
        changeUnactive = (element) => {
            element.classList.toggle("unactive");
        }
        changeActiveThis = (element) => {
            element.classList.toggle("activeThis");
        }
		
		// construct the list of existing GA in the DOM
		var GAs = new ExistingGA();
		var selectGA = document.querySelector(".choose>.validate");
		for(var i=0; i<GAs.GAArray.length; i++){
			var newNode = document.createElement("p");
			newNode.innerHTML = GAs.GAArray[i].name;
			document.querySelector(".choose").insertBefore(newNode,selectGA);
		}
		
		/*//// EVENT LISTENERS ////*/
		

        var account = new Account();
        account.isLoggedIn();


		function myFunction() {
			var elsClass = {};
			[".circleBase", ".type1"].forEach(x => elsClass[x.replace(/[.]/g, '')] = document.querySelectorAll(x));
            for (var i = 0; i < elsClass.circleBase.length; i++) {
                elsClass.circleBase[i].onclick = (function (i) {
                    return function () {
                        // indice i pour la div cliquée et (i+1)%3 et (i+2)%3 pour les deux classes restantes 
                        if (elsClass.circleBase[i].classList.contains("indexPage"))
                        {
                            changeActiveThis(elsClass.circleBase[i]);
                            console.log("wesh ça va ?");
                        }
                        else if (elsClass.circleBase[i].classList.contains("active")==false){
							changeActive(elsClass.circleBase[i]);
							document.getElementById("icons").classList.toggle("activeDiv");
							changeUnactive(elsClass.circleBase[(i + 1) % 3]);
							changeUnactive(elsClass.circleBase[(i + 2) % 3]);
                        }
                    }
                })(i);
            }
        }
		
		
		/*//// EVENT LISTENERS ////*/
        
        myFunction();
        els.iconOpen.addEventListener("click", DisplaySignIn);
        function DisplaySignIn() {
            if(account.state){
                window.location.replace("./project.html");
            }
			else{
                if (els.iconOpen.classList.contains("unclickable")==false){
				    els.signIn.classList.toggle("activeClass");
				    els.iconOpen.classList.add("unclickable");
			    }
            }
        }

        els.iconCreate.addEventListener("click", DisplayChooseGA)
        function DisplayChooseGA() {
			if ( els.iconCreate.classList.contains("unclickable")==false){
				els.chooseGA.classList.toggle("activeClass2");
				els.iconCreate.classList.add("unclickable");
			}
		}

        document.getElementById("createGA").addEventListener("click", DisplayCreateGA)
        function DisplayCreateGA() {
            document.getElementById("chooseGA").classList.toggle("activeClass2");
            document.getElementById("createAlgebra").classList.toggle("activeClass");
        }
		
		els.goBackStart.addEventListener("click", goBackStart);
		function goBackStart(){
			var elsClass = {};
			[".activeClass", ".activeClass2", ".unclickable", ".activeDiv", ".active", ".unactive"].forEach(x => elsClass[x.replace(/[.]/g, '')] = document.querySelectorAll(x));
			for(var i=0; i<elsClass.activeClass.length; i++)
				elsClass.activeClass[i].classList.remove("activeClass");
								
			for(var i=0; i<elsClass.activeClass2.length; i++)
				elsClass.activeClass2[i].classList.remove("activeClass2");
			
			for(var i=0; i<elsClass.unclickable.length; i++)
				elsClass.unclickable[i].classList.remove("unclickable");
				
			for(var i=0; i<elsClass.activeDiv.length; i++)
				elsClass.activeDiv[i].classList.remove("activeDiv");
				
			for(var i=0; i<elsClass.active.length; i++)
				elsClass.active[i].classList.remove("active");
				
			for(var i=0; i<elsClass.unactive.length; i++)
				elsClass.unactive[i].classList.remove("unactive");
		}

        /*els.validate.addEventListener("click",DisplayProjectList)
        function DisplayProjectList(){
            els.projectList.classList.toggle("activeClass");
            els.signIn.classList.toggle("activeClass");
        }*/
		
		document.querySelector("#createAlgebra>.validate>a>i").addEventListener("click", createGA);
		function createGA(){
			// retrieve info form form
			var name = els.formCreateGA.nameGA.value;
			var dimensions = els.formCreateGA.dimensionGA.value;
			var basis = els.formCreateGA.basisGA.value;
			var metric = els.formCreateGA.metricGA.value;
			var vectorsDef = els.formCreateGA.vectorsGA.value;
			var pointDef = els.formCreateGA.pointGA.value;
			// create the GA object
			var userGA = new GA(name, dimensions, basis, metric, vectorsDef, pointDef);
			
			//localStorage
			if (typeof(Storage) !== "undefined") {
				localStorage.setItem("createGA", userGA.consoleString());
			} else {
				console.log("Sorry! No Web Storage support.");
			}
		}
		
		// select existing GA
		var GAToChoose = document.querySelectorAll(".choose p");
		console.log(GAToChoose);
		for(var i=0; i<GAToChoose.length; i++){
			GAToChoose[i].onclick = (function(i){
				return function(){
					console.log("Meh, i :" + i);
					sendGA(GAs.GAArray[i]);
				}
			})(i);
		}
		function sendGA(aGA){
			//localStorage
			if (typeof(Storage) !== "undefined") {
				console.log(aGA.consoleString());
				localStorage.setItem("createGA", aGA.consoleString());
				window.location.replace("index.html");
			} else {
				console.log("Sorry! No Web Storage support.");
			}
		}

        els.check.onclick = () =>{
            account.signIn(true);
        }

        /*document.getElementById("iconExample").addEventListener("click",DisplayExample)
        function DisplayExample(){
            window.open("index.html");
        }*/
		
    </script>
</body>

</html>